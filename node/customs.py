from __future__ import absolute_import, unicode_literals
import json
import os
import socket

from .celery import app
from .modules import BaseCeleryTask


# {
#     "action": "node.customs.exec_command",
#     "params": {
#         "cmd": "nmap -T4 -F 127.0.0.1"
#     },
#     "target": "exec",
# }
@app.task(bind=True, base=BaseCeleryTask)
def exec_command(self, job):
    import commands
    job = json.loads(job)
    params = job['params']
    result = commands.getoutput(params['cmd'])
    return result
