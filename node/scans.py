from __future__ import absolute_import, unicode_literals

import time
import random
import json

from .celery import app
from .modules import BaseCeleryTask


@app.task(bind=True, base=BaseCeleryTask)
def dnsenum(self, job):

    try:
        job = json.loads(job)
        job['results'] = []

        for t in job['targets']:
            job['results'].append('vul')
        if random.randint(0, 10) < 3:
            raise Exception("My Exception")
        return job
    except Exception as ex:
        raise self.retry(ex=ex, countdown=60)
